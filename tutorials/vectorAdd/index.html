
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Project documentation with Markdown.">
      
      
        <meta name="author" content="Michael Redenti">
      
      
      
        <link rel="prev" href="../installation/">
      
      
        <link rel="next" href="../matrixVector/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.9">
    
    
      
        <title>Exercise 0: Vector Addition - Programming Heterogeneous Computing Systems</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.78cf6014.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tutorial-01-vector-addition" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Programming Heterogeneous Computing Systems" class="md-header__button md-logo" aria-label="Programming Heterogeneous Computing Systems" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Programming Heterogeneous Computing Systems
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Exercise 0: Vector Addition
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mredenti/Kokkos" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="./" class="md-tabs__link">
          
  
  SYCL

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../installation/" class="md-tabs__link">
          
  
  KOKKOS

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Programming Heterogeneous Computing Systems" class="md-nav__button md-logo" aria-label="Programming Heterogeneous Computing Systems" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Programming Heterogeneous Computing Systems
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mredenti/Kokkos" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    SYCL
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            SYCL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="./" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prerequisites 01: Templates/Template Metaprogramming
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="./" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prerequisites 02: Functors & Lambdas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="./" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial 01: vector addition
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    KOKKOS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            KOKKOS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup: Installing Kokkos and Tutorial Environment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Exercise 0: Vector Addition
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Exercise 0: Vector Addition
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-quick-comparison-between-cuda-and-c" class="md-nav__link">
    <span class="md-ellipsis">
      A quick comparison between CUDA and C
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compiling-cuda-programs" class="md-nav__link">
    <span class="md-ellipsis">
      Compiling CUDA programs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#putting-things-in-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Putting things in actions.
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-converting-vector-addition-to-cuda" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise: Converting vector addition to CUDA
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exercise: Converting vector addition to CUDA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#device-memory-management" class="md-nav__link">
    <span class="md-ellipsis">
      Device memory management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-transfer" class="md-nav__link">
    <span class="md-ellipsis">
      Memory transfer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-cont-completing-vector-addition" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise (Con't): Completing vector addition
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exercise (Con't): Completing vector addition">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-solution-for-array-a" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Solution for array 'a'
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#profiling-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Profiling performance
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wrap-up" class="md-nav__link">
    <span class="md-ellipsis">
      Wrap up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acknowledgments" class="md-nav__link">
    <span class="md-ellipsis">
      Acknowledgments
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../matrixVector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exercise 1: Matrix-Vector Multiplication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../matrix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exercise 2: Matrix-Matrix Multiplication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../heatMiniApp/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Porting Heat Conduction Mini-App to Kokkos
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<p>In this first tutorial we will be profile the performance of vector addition written in Kokkos.  </p>
<pre class="highlight"><code class="language-shell">module load cuda/11.8 gcc/11.3.0
make
srun -N 1 --ntasks-per-node=1 --cpus-per-task=1 --gres=gpu:1 -A cin_staff -p boost_usr_prod --time=00:30:00 -
-pty /bin/bash
OMP_PROC_BIND=spread OMP_PLACES=threads ./vector_add.x</code></pre>
<h1 id="tutorial-01-vector-addition">Tutorial 01: Vector Addition<a class="headerlink" href="#tutorial-01-vector-addition" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>This tutorial is an introduction for writing your first C++-Kokkos program and offload computation to a GPU. </p>
<h2 id="a-quick-comparison-between-cuda-and-c">A quick comparison between CUDA and C<a class="headerlink" href="#a-quick-comparison-between-cuda-and-c" title="Permanent link">&para;</a></h2>
<p>Following table compares a hello world program in C and CUDA side-by-side. </p>
<div style="float:left;margin-right:10px;">
<p><strong>C</strong></p>
<pre class="highlight"><code class="language-C">void c_hello(){
    printf("Hello World!\n");
}

int main() {
    c_hello();
    return 0;
}</code></pre>
</div>
<div>
<p><strong>CUDA</strong>
<pre class="highlight"><code class="language-C">__global__ void cuda_hello(){
    printf("Hello World from GPU!\n");
}

int main() {
    cuda_hello&lt;&lt;&lt;1,1&gt;&gt;&gt;(); 
    return 0;
}</code></pre></p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="c" name="__tabbed_1" type="radio" /><input id="c_1" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="c">C</label><label for="c_1">C++</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<pre class="highlight"><code class="language-c">#include &lt;stdio.h&gt;

int main(void) {
  printf("Hello world!\n");
  return 0;
}</code></pre>
</div>
<div class="tabbed-block">
<pre class="highlight"><code class="language-c++">#include &lt;iostream&gt;

int main(void) {
  std::cout &lt;&lt; "Hello world!" &lt;&lt; std::endl;
  return 0;
}</code></pre>
</div>
</div>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="unordered-list" name="__tabbed_2" type="radio" /><input id="ordered-list" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="unordered-list">Unordered List</label><label for="ordered-list">Ordered List</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<pre class="highlight"><code class="language-markdown">* Sed sagittis eleifend rutrum
* Donec vitae suscipit est
* Nulla tempor lobortis orci</code></pre>
</div>
<div class="tabbed-block">
<pre class="highlight"><code class="language-markdown">1. Sed sagittis eleifend rutrum
2. Donec vitae suscipit est
3. Nulla tempor lobortis orci</code></pre>
</div>
</div>
</div>
</div>
<p><strong>KOKKOS</strong></p>
<pre class="highlight"><code class="language-C">#include &lt;Kokkos_core.hpp&gt;

int main(int argc, char* argv) {

    Kokkos::initialize(argc, argv);


    Kokkos::finalize();

    return 0;
}</code></pre>
</div>
<p>The major difference between C and CUDA implementation is <code>__global__</code> specifier and <code>&lt;&lt;&lt;...&gt;&gt;&gt;</code> syntax. The <code>__global__</code> specifier indicates a function that runs on device (GPU). Such function can be called through host code, e.g. the <code>main()</code> function in the example, and is also known as "<em>kernels</em>". </p>
<p>When a kernel is called, its execution configuration is provided through <code>&lt;&lt;&lt;...&gt;&gt;&gt;</code> syntax, e.g. <code>cuda_hello&lt;&lt;&lt;1,1&gt;&gt;&gt;()</code>. In CUDA terminology, this is called "<em>kernel launch</em>". We will discuss about the parameter <code>(1,1)</code> later in this </p>
<h2 id="compiling-cuda-programs">Compiling CUDA programs<a class="headerlink" href="#compiling-cuda-programs" title="Permanent link">&para;</a></h2>
<p>Compiling a CUDA program is similar to C program. NVIDIA provides a CUDA compiler called <code>nvcc</code> in the CUDA toolkit to compile CUDA code, typically stored in a file with extension <code>.cu</code>. For example</p>
<pre class="highlight"><code class="language-bash">$&gt; nvcc hello.cu -o hello</code></pre>
<p>You might see following warning when compiling a CUDA program using above command</p>
<pre class="highlight"><code>nvcc warning : The 'compute_20', 'sm_20', and 'sm_21' architectures are deprecated, and may be removed in a future release (Use -Wno-deprecated-gpu-targets to suppress warning).</code></pre>
<p>This warning can be ignored as of now. </p>
<h2 id="putting-things-in-actions">Putting things in actions.<a class="headerlink" href="#putting-things-in-actions" title="Permanent link">&para;</a></h2>
<p>The CUDA hello world example does nothing, and even if the program is compiled, nothing will show up on screen. To get things into action, we will looks at vector addition. </p>
<p>Following is an example of vector addition implemented in C . The example computes the addtion of two vectors stored in array <code>a</code> and <code>b</code> and put the result in array <code>out</code>.</p>
<pre class="highlight"><code class="language-C">#define N 10000000

void vector_add(float *out, float *a, float *b, int n) {
    for(int i = 0; i &lt; n; i++){
        out[i] = a[i] + b[i];
    }
}

int main(){
    float *a, *b, *out; 

    // Allocate memory
    a   = (float*)malloc(sizeof(float) * N);
    b   = (float*)malloc(sizeof(float) * N);
    out = (float*)malloc(sizeof(float) * N);

    // Initialize array
    for(int i = 0; i &lt; N; i++){
        a[i] = 1.0f; b[i] = 2.0f;
    }

    // Main function
    vector_add(out, a, b, N);
}
</code></pre>
<h2 id="exercise-converting-vector-addition-to-cuda">Exercise: Converting vector addition to CUDA<a class="headerlink" href="#exercise-converting-vector-addition-to-cuda" title="Permanent link">&para;</a></h2>
<p>In the first exercise, we will convert <code>vector_add.c</code> to CUDA program <code>vector_add.cu</code> by using the hello world as example.</p>
<ol>
<li>Copy <code>vector_add.c</code> to <code>vector_add.cu</code></li>
</ol>
<pre class="highlight"><code class="language-bash">$&gt; cp vector_add.c vector_add.cu</code></pre>
<ol>
<li>Convert <code>vector_add()</code> to GPU kernel</li>
</ol>
<pre class="highlight"><code class="language-C">__global__ void vector_add(float *out, float *a, float *b, int n) {
    for(int i = 0; i &lt; n; i++){
        out[i] = a[i] + b[i];
    }
}</code></pre>
<ol>
<li>Change <code>vector_add()</code> call in <code>main()</code> to kernel call</li>
</ol>
<pre class="highlight"><code class="language-C">vector_add&lt;&lt;&lt;1,1&gt;&gt;&gt;(out, a, b, N);</code></pre>
<ol>
<li>Compile and run the program
<pre class="highlight"><code class="language-bash">$&gt; nvcc vector_add.c -o vector_add
$&gt; ./vector_add</code></pre></li>
</ol>
<p>You will notice that the program does not work correctly. The reason is CPU and GPUs are separate entities. Both have their own memory space. CPU cannot directly access GPU memory, and vice versa. In CUDA terminology, CPU memory is called <em>host memory</em> and GPU memory is called <em>device memory</em>. Pointers to CPU and GPU memory are called <em>host pointer</em> and <em>device pointer</em>, respectively. </p>
<p>For data to be accessible by GPU, it must be presented in the device memory. CUDA provides APIs for allocating device memory and data transfer between host and device memory. Following is the common workflow of CUDA programs. </p>
<ol>
<li>Allocate host memory and initialized host data</li>
<li>Allocate device memory</li>
<li>Transfer input data from host to device memory</li>
<li>Execute kernels</li>
<li>Transfer output from device memory to host</li>
</ol>
<p>So far, we have done step 1 and 4. We will add step 2, 3, and 5 to our vector addition program and finish this exercise. </p>
<h3 id="device-memory-management">Device memory management<a class="headerlink" href="#device-memory-management" title="Permanent link">&para;</a></h3>
<p>CUDA provides several functions for allocating device memory. The most common ones are <code>cudaMalloc()</code> and <code>cudaFree()</code>. The syntax for both functions are as follow</p>
<pre class="highlight"><code class="language-C">cudaMalloc(void **devPtr, size_t count);
cudaFree(void *devPtr);</code></pre>
<p><code>cudaMalloc()</code> allocates memory of size <code>count</code> in the device memory and updates the device pointer <code>devPtr</code> to the allocated memory. <code>cudaFree()</code> deallocates a region of the device memory where the device pointer <code>devPtr</code> points to. They are comparable to <code>malloc()</code> and <code>free()</code> in C, respectively</p>
<h3 id="memory-transfer">Memory transfer<a class="headerlink" href="#memory-transfer" title="Permanent link">&para;</a></h3>
<p>Transfering data between host and device memory can be done through <code>cudaMemcpy</code> function, which is similar to <code>memcpy</code> in C. The syntax of <code>cudaMemcpy</code> is as follow</p>
<pre class="highlight"><code class="language-C">cudaMemcpy(void *dst, void *src, size_t count, cudaMemcpyKind kind)</code></pre>
<p>The function copy a memory of size <code>count</code> from <code>src</code> to <code>dst</code>. <code>kind</code> indicates the direction. For typical usage, the value of <code>kind</code> is either <code>cudaMemcpyHostToDevice</code> or <code>cudaMemcpyDeviceToHost</code>. There are other possible values but we will not touch them in this tutorial. </p>
<h3 id="exercise-cont-completing-vector-addition">Exercise (Con't): Completing vector addition<a class="headerlink" href="#exercise-cont-completing-vector-addition" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Allocate and deallocate device memory for array <code>a</code>, <code>b</code>, and <code>out</code>. </p>
</li>
<li>
<p>Transfer <code>a</code>, <code>b</code>, and <code>out</code> between host and device memory. </p>
<ul>
<li>Quiz: Which array must be transferred before and after kernel execution ?</li>
</ul>
</li>
</ol>
<h4 id="example-solution-for-array-a">Example: Solution for array 'a'<a class="headerlink" href="#example-solution-for-array-a" title="Permanent link">&para;</a></h4>
<pre class="highlight"><code class="language-C">void main(){
    float *a, *b, *out;
    float *d_a;

    a = (float*)malloc(sizeof(float) * N);

    // Allocate device memory for a
    cudaMalloc((void**)&amp;d_a, sizeof(float) * N);

    // Transfer data from host to device memory
    cudaMemcpy(d_a, a, sizeof(float) * N, cudaMemcpyHostToDevice);

    …
    vector_add&lt;&lt;&lt;1,1&gt;&gt;&gt;(out, d_a, b, N);
    …

    // Cleanup after kernel execution
    cudaFree(d_a);
    free(a);
}</code></pre>
<ol>
<li>Compile and measure performance. </li>
</ol>
<pre class="highlight"><code class="language-bash">$&gt; nvcc vector_add.cu -o vector_add
$&gt; time ./vector_add</code></pre>
<h2 id="profiling-performance">Profiling performance<a class="headerlink" href="#profiling-performance" title="Permanent link">&para;</a></h2>
<p>Using <code>time</code> does not give much information about the program performance. NVIDIA provides a commandline profiler tool called <code>nvprof</code>, which give a more insight information of CUDA program performance.  </p>
<p>To profile our vector addition, use following command</p>
<pre class="highlight"><code class="language-bash">$&gt; nvprof ./vector_add</code></pre>
<p>Following is an example profiling result on Tesla M2050</p>
<pre class="highlight"><code>==6326== Profiling application: ./vector_add
==6326== Profiling result:
Time(%)      Time     Calls       Avg       Min       Max  Name
 97.55%  1.42529s         1  1.42529s  1.42529s  1.42529s  vector_add(float*, float*, float*, int)
  1.39%  20.318ms         2  10.159ms  10.126ms  10.192ms  [CUDA memcpy HtoD]
  1.06%  15.549ms         1  15.549ms  15.549ms  15.549ms  [CUDA memcpy DtoH]</code></pre>
<h2 id="wrap-up">Wrap up<a class="headerlink" href="#wrap-up" title="Permanent link">&para;</a></h2>
<p>In this tutorial, we demonstrate how to write a simple vector addition in CUDA. We introduced GPU kernels and its execution from host code. Moreover, we introduced the concept of separated memory space between CPU and GPU. We also demonstrate how to manage the device memory. </p>
<p>However, we still not run program in parallel. The kernel execution configuration <code>&lt;&lt;&lt;1,1&gt;&gt;&gt;</code> indicates that the kernel is launched with only 1 thread. In the next tutorial ../tutorial02/, we will modify vector addition to run in parallel. </p>
<h2 id="acknowledgments">Acknowledgments<a class="headerlink" href="#acknowledgments" title="Permanent link">&para;</a></h2>
<ul>
<li>Contents are adopted from <a href="https://devblogs.nvidia.com/even-easier-introduction-cuda/">An Even Easier Introduction to CUDA</a> by Mark Harris, NVIDIA and <a href="http://www.int.washington.edu/PROGRAMS/12-2c/week3/clark_01.pdf">CUDA C/C++ Basics</a> by Cyril Zeller, NVIDIA. </li>
</ul>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">November 18, 2023</span>
      
        <br>
        Created:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">November 18, 2023</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2023 <a href="https://github.com/mredenti"  target="_blank" rel="noopener">Michael Redenti</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight", "search.share", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6c14ae12.min.js"></script>
      
    
  </body>
</html>